<?xml version="1.0" encoding="UTF-8"?>
<!--
********************************************************************************
*                  jMCS project ( http://www.jmmc.fr/dev/jmcs )
********************************************************************************
*  Copyright (c) 2013, CNRS. All rights reserved.
*  
*  Redistribution and use in source and binary forms, with or without
*  modification, are permitted provided that the following conditions are met:
*      - Redistributions of source code must retain the above copyright
*        notice, this list of conditions and the following disclaimer.
*      - Redistributions in binary form must reproduce the above copyright
*        notice, this list of conditions and the following disclaimer in the
*        documentation and/or other materials provided with the distribution.
*      - Neither the name of the CNRS nor the names of its contributors may be
*        used to endorse or promote products derived from this software without
*        specific prior written permission.
*  
*  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
*  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
*  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
*  ARE DISCLAIMED. IN NO EVENT SHALL CNRS BE LIABLE FOR ANY DIRECT, INDIRECT,
*  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
*  LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,
*  OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
*  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
*  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
*  EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
********************************************************************************
-->

<project name="JMCS" default="about" basedir=".">

    <description>
        JMCS ant build file
    </description>

    <property name="root" location=".."/>

    <!-- NOTE: jmcs is supposed to be in the parent folder -->
    <property name="jmcs" location="${root}/../jmcs"/>

    <property name="libs" location="${jmcs}/lib"/>
    <property name="sources" location="${root}/src"/>


    <!-- custom macro to enhance XJC -->
    <macrodef name="xjc">
        <attribute name="destdir"/>
        <attribute name="schema"/>

        <sequential>
            <java jar="${libs}/jaxb-xjc.jar" fork="true" failonerror="true">
                <arg value="-classpath"/>
                <arg value="${libs}/simple-regenerator-1.0.jar"/>

                <arg value="-no-header"/>

                <arg value="-extension"/>
                <!-- preserve code extension -->
                <arg value="-simple-preserve"/>

                <arg value="-d"/>
                <arg value="@{destdir}"/>

                <arg value="@{schema}"/>
            </java>

            <!-- remove backup files -->
            <delete includeemptydirs="false">
                <fileset dir="@{destdir}">
                    <include name="**/*.java.backup"/>
                </fileset>
            </delete>
        </sequential>
    </macrodef>


    <!-- targets -->

    <!-- target about : -->
    <target name="about" description="show information for public targets">
        <echo>available ant targets : </echo>
        <echo>-------------------------------------------------------------------------------</echo>
        <echo>  - genXsdCode         : generates the java code from xml schemas (xsd)</echo>
        <echo>-------------------------------------------------------------------------------</echo>
    </target>




    <!-- target about : -->
    <target name="checkJMCS">
        <echo>-------------------------------------------------------------------------------</echo>
        <echo>JMCS Path: ${jmcs}</echo>
        <echo>-------------------------------------------------------------------------------</echo>
 
        <!-- check jmcs path -->
        <available property="jmcs.check" file="${jmcs}/src/jmcs.doc" />
        <fail unless="jmcs.check" message="jmcs project does not exist in ${jmcs} !" />

    </target>




    <target name="genXsdCode" depends="checkJMCS" description="generates the java code from xml schemas (xsd)">
    
        <echo>generating java code for ApplicationDataModel.xsd</echo>

        <mkdir dir="${sources}/fr/jmmc/jmcs/data/app/model" />

        <xjc destdir="${sources}" schema="${sources}/fr/jmmc/jmcs/data/app/ApplicationDataModel.xsd" />

    </target>

</project>
